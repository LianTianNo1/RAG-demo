import{j as e,M as ze}from"./utils-D84y-Eax.js";import{c as Oe,g as De,r as m,R as ke}from"./vendor-o6zXO7vr.js";import{T as B,C as ge,R as Le,a as je,b as F,S as $,c as Ae,d as N,e as ae,I as Fe,E as ye,f as E,B as T,g as Ue,h as se,i as Be,A as ce,j as U,U as Ye,k as qe,P as Ke,l as Ve,m as Ge,n as de,L as ee,o as He,p as Je,s as _,q as ue,r as We,t as Qe,u as ve,D as fe,v as Xe,w as Ze,x as me,y as pe,z as et,F as tt}from"./antd-Brh7cmhH.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function l(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=l(s);fetch(s.href,r)}})();var re={},xe=Oe;re.createRoot=xe.createRoot,re.hydrateRoot=xe.hydrateRoot;var Y={},be={exports:{}};(function(t){function o(l){return l&&l.__esModule?l:{default:l}}t.exports=o,t.exports.__esModule=!0,t.exports.default=t.exports})(be);var q=be.exports,K={};Object.defineProperty(K,"__esModule",{value:!0});K.default=void 0;var st={items_per_page:"æ¡/é¡µ",jump_to:"è·³è‡³",jump_to_confirm:"ç¡®å®š",page:"é¡µ",prev_page:"ä¸Šä¸€é¡µ",next_page:"ä¸‹ä¸€é¡µ",prev_5:"å‘å‰ 5 é¡µ",next_5:"å‘å 5 é¡µ",prev_3:"å‘å‰ 3 é¡µ",next_3:"å‘å 3 é¡µ",page_size:"é¡µç "};K.default=st;var V={},z={},G={},Ne={exports:{}},Se={exports:{}},_e={exports:{}},$e={exports:{}};(function(t){function o(l){"@babel/helpers - typeof";return t.exports=o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},t.exports.__esModule=!0,t.exports.default=t.exports,o(l)}t.exports=o,t.exports.__esModule=!0,t.exports.default=t.exports})($e);var we=$e.exports,Pe={exports:{}};(function(t){var o=we.default;function l(n,s){if(o(n)!="object"||!n)return n;var r=n[Symbol.toPrimitive];if(r!==void 0){var i=r.call(n,s||"default");if(o(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(n)}t.exports=l,t.exports.__esModule=!0,t.exports.default=t.exports})(Pe);var rt=Pe.exports;(function(t){var o=we.default,l=rt;function n(s){var r=l(s,"string");return o(r)=="symbol"?r:r+""}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports})(_e);var at=_e.exports;(function(t){var o=at;function l(n,s,r){return(s=o(s))in n?Object.defineProperty(n,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[s]=r,n}t.exports=l,t.exports.__esModule=!0,t.exports.default=t.exports})(Se);var ot=Se.exports;(function(t){var o=ot;function l(s,r){var i=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);r&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),i.push.apply(i,a)}return i}function n(s){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?l(Object(i),!0).forEach(function(a){o(s,a,i[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(i)):l(Object(i)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(i,a))})}return s}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports})(Ne);var nt=Ne.exports,H={};Object.defineProperty(H,"__esModule",{value:!0});H.commonLocale=void 0;H.commonLocale={yearFormat:"YYYY",dayFormat:"D",cellMeridiemFormat:"A",monthBeforeYear:!0};var lt=q.default;Object.defineProperty(G,"__esModule",{value:!0});G.default=void 0;var he=lt(nt),it=H,ct=(0,he.default)((0,he.default)({},it.commonLocale),{},{locale:"zh_CN",today:"ä»Šå¤©",now:"æ­¤åˆ»",backToToday:"è¿”å›ä»Šå¤©",ok:"ç¡®å®š",timeSelect:"é€‰æ‹©æ—¶é—´",dateSelect:"é€‰æ‹©æ—¥æœŸ",weekSelect:"é€‰æ‹©å‘¨",clear:"æ¸…é™¤",week:"å‘¨",month:"æœˆ",year:"å¹´",previousMonth:"ä¸Šä¸ªæœˆ (ç¿»é¡µä¸Šé”®)",nextMonth:"ä¸‹ä¸ªæœˆ (ç¿»é¡µä¸‹é”®)",monthSelect:"é€‰æ‹©æœˆä»½",yearSelect:"é€‰æ‹©å¹´ä»½",decadeSelect:"é€‰æ‹©å¹´ä»£",previousYear:"ä¸Šä¸€å¹´ (Controlé”®åŠ å·¦æ–¹å‘é”®)",nextYear:"ä¸‹ä¸€å¹´ (Controlé”®åŠ å³æ–¹å‘é”®)",previousDecade:"ä¸Šä¸€å¹´ä»£",nextDecade:"ä¸‹ä¸€å¹´ä»£",previousCentury:"ä¸Šä¸€ä¸–çºª",nextCentury:"ä¸‹ä¸€ä¸–çºª",yearFormat:"YYYYå¹´",cellDateFormat:"D",monthBeforeYear:!1});G.default=ct;var O={};Object.defineProperty(O,"__esModule",{value:!0});O.default=void 0;const dt={placeholder:"è¯·é€‰æ‹©æ—¶é—´",rangePlaceholder:["å¼€å§‹æ—¶é—´","ç»“æŸæ—¶é—´"]};O.default=dt;var Ie=q.default;Object.defineProperty(z,"__esModule",{value:!0});z.default=void 0;var ut=Ie(G),ft=Ie(O);const Re={lang:Object.assign({placeholder:"è¯·é€‰æ‹©æ—¥æœŸ",yearPlaceholder:"è¯·é€‰æ‹©å¹´ä»½",quarterPlaceholder:"è¯·é€‰æ‹©å­£åº¦",monthPlaceholder:"è¯·é€‰æ‹©æœˆä»½",weekPlaceholder:"è¯·é€‰æ‹©å‘¨",rangePlaceholder:["å¼€å§‹æ—¥æœŸ","ç»“æŸæ—¥æœŸ"],rangeYearPlaceholder:["å¼€å§‹å¹´ä»½","ç»“æŸå¹´ä»½"],rangeMonthPlaceholder:["å¼€å§‹æœˆä»½","ç»“æŸæœˆä»½"],rangeQuarterPlaceholder:["å¼€å§‹å­£åº¦","ç»“æŸå­£åº¦"],rangeWeekPlaceholder:["å¼€å§‹å‘¨","ç»“æŸå‘¨"]},ut.default),timePickerLocale:Object.assign({},ft.default)};Re.lang.ok="ç¡®å®š";z.default=Re;var mt=q.default;Object.defineProperty(V,"__esModule",{value:!0});V.default=void 0;var pt=mt(z);V.default=pt.default;var J=q.default;Object.defineProperty(Y,"__esModule",{value:!0});Y.default=void 0;var xt=J(K),ht=J(V),gt=J(z),jt=J(O);const g="${label}ä¸æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„${type}",yt={locale:"zh-cn",Pagination:xt.default,DatePicker:gt.default,TimePicker:jt.default,Calendar:ht.default,global:{placeholder:"è¯·é€‰æ‹©",close:"å…³é—­"},Table:{filterTitle:"ç­›é€‰",filterConfirm:"ç¡®å®š",filterReset:"é‡ç½®",filterEmptyText:"æ— ç­›é€‰é¡¹",filterCheckAll:"å…¨é€‰",filterSearchPlaceholder:"åœ¨ç­›é€‰é¡¹ä¸­æœç´¢",emptyText:"æš‚æ— æ•°æ®",selectAll:"å…¨é€‰å½“é¡µ",selectInvert:"åé€‰å½“é¡µ",selectNone:"æ¸…ç©ºæ‰€æœ‰",selectionAll:"å…¨é€‰æ‰€æœ‰",sortTitle:"æ’åº",expand:"å±•å¼€è¡Œ",collapse:"å…³é—­è¡Œ",triggerDesc:"ç‚¹å‡»é™åº",triggerAsc:"ç‚¹å‡»å‡åº",cancelSort:"å–æ¶ˆæ’åº"},Modal:{okText:"ç¡®å®š",cancelText:"å–æ¶ˆ",justOkText:"çŸ¥é“äº†"},Tour:{Next:"ä¸‹ä¸€æ­¥",Previous:"ä¸Šä¸€æ­¥",Finish:"ç»“æŸå¯¼è§ˆ"},Popconfirm:{cancelText:"å–æ¶ˆ",okText:"ç¡®å®š"},Transfer:{titles:["",""],searchPlaceholder:"è¯·è¾“å…¥æœç´¢å†…å®¹",itemUnit:"é¡¹",itemsUnit:"é¡¹",remove:"åˆ é™¤",selectCurrent:"å…¨é€‰å½“é¡µ",removeCurrent:"åˆ é™¤å½“é¡µ",selectAll:"å…¨é€‰æ‰€æœ‰",deselectAll:"å–æ¶ˆå…¨é€‰",removeAll:"åˆ é™¤å…¨éƒ¨",selectInvert:"åé€‰å½“é¡µ"},Upload:{uploading:"æ–‡ä»¶ä¸Šä¼ ä¸­",removeFile:"åˆ é™¤æ–‡ä»¶",uploadError:"ä¸Šä¼ é”™è¯¯",previewFile:"é¢„è§ˆæ–‡ä»¶",downloadFile:"ä¸‹è½½æ–‡ä»¶"},Empty:{description:"æš‚æ— æ•°æ®"},Icon:{icon:"å›¾æ ‡"},Text:{edit:"ç¼–è¾‘",copy:"å¤åˆ¶",copied:"å¤åˆ¶æˆåŠŸ",expand:"å±•å¼€",collapse:"æ”¶èµ·"},Form:{optional:"ï¼ˆå¯é€‰ï¼‰",defaultValidateMessages:{default:"å­—æ®µéªŒè¯é”™è¯¯${label}",required:"è¯·è¾“å…¥${label}",enum:"${label}å¿…é¡»æ˜¯å…¶ä¸­ä¸€ä¸ª[${enum}]",whitespace:"${label}ä¸èƒ½ä¸ºç©ºå­—ç¬¦",date:{format:"${label}æ—¥æœŸæ ¼å¼æ— æ•ˆ",parse:"${label}ä¸èƒ½è½¬æ¢ä¸ºæ—¥æœŸ",invalid:"${label}æ˜¯ä¸€ä¸ªæ— æ•ˆæ—¥æœŸ"},types:{string:g,method:g,array:g,object:g,number:g,date:g,boolean:g,integer:g,float:g,regexp:g,email:g,url:g,hex:g},string:{len:"${label}é¡»ä¸º${len}ä¸ªå­—ç¬¦",min:"${label}æœ€å°‘${min}ä¸ªå­—ç¬¦",max:"${label}æœ€å¤š${max}ä¸ªå­—ç¬¦",range:"${label}é¡»åœ¨${min}-${max}å­—ç¬¦ä¹‹é—´"},number:{len:"${label}å¿…é¡»ç­‰äº${len}",min:"${label}æœ€å°å€¼ä¸º${min}",max:"${label}æœ€å¤§å€¼ä¸º${max}",range:"${label}é¡»åœ¨${min}-${max}ä¹‹é—´"},array:{len:"é¡»ä¸º${len}ä¸ª${label}",min:"æœ€å°‘${min}ä¸ª${label}",max:"æœ€å¤š${max}ä¸ª${label}",range:"${label}æ•°é‡é¡»åœ¨${min}-${max}ä¹‹é—´"},pattern:{mismatch:"${label}ä¸æ¨¡å¼ä¸åŒ¹é…${pattern}"}}},Image:{preview:"é¢„è§ˆ"},QRCode:{expired:"äºŒç»´ç è¿‡æœŸ",refresh:"ç‚¹å‡»åˆ·æ–°",scanned:"å·²æ‰«æ"},ColorPicker:{presetEmpty:"æš‚æ— ",transparent:"æ— è‰²",singleColor:"å•è‰²",gradientColor:"æ¸å˜è‰²"}};Y.default=yt;var vt=Y;const bt=De(vt),{Text:I}=B,{Panel:Dt}=ge;function Nt({messages:t,streamingMessage:o}){const l=a=>new Date(a).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),n=a=>!a||a.length===0?null:e.jsx("div",{className:"tool-calls-section",children:e.jsx(ge,{size:"small",ghost:!0,items:a.map((d,u)=>{var y,v,S;let h={};try{h=JSON.parse(((y=d.function)==null?void 0:y.arguments)||"{}")}catch{h={raw:((v=d.function)==null?void 0:v.arguments)||""}}return{key:u,label:e.jsxs($,{children:[e.jsx(Ae,{}),e.jsx(I,{strong:!0,children:((S=d.function)==null?void 0:S.name)||"unknown"}),e.jsx(N,{color:"blue",size:"small",children:"å·¥å…·è°ƒç”¨"})]}),children:e.jsx("div",{className:"tool-call-content",children:e.jsx(I,{code:!0,className:"tool-args",children:JSON.stringify(h,null,2)})})}})})}),s=a=>!a||a.length===0?null:e.jsxs("div",{className:"sources-section",children:[e.jsxs("div",{className:"sources-header",children:[e.jsx(ae,{}),e.jsx(I,{strong:!0,children:"ä¿¡æ¯æ¥æº"})]}),e.jsx("div",{className:"sources-list",children:a.map((d,u)=>e.jsxs("div",{className:"source-item",children:[e.jsx(N,{color:"green",size:"small",children:d.file}),e.jsxs(I,{type:"secondary",children:["å·¥ä½œè¡¨: ",d.sheet]})]},u))})]}),r=a=>{const d=a.role==="user",u=a.role==="system",h=a.isStreaming;return e.jsxs("div",{className:`message-item ${d?"user":u?"system":"assistant"} ${h?"streaming":""}`,children:[e.jsx("div",{className:"message-avatar",children:d?e.jsx(Le,{}):u?e.jsx(je,{}):e.jsx(F,{})}),e.jsxs("div",{className:"message-content",children:[e.jsxs("div",{className:"message-header",children:[e.jsx(I,{strong:!0,className:"message-role",children:d?"ç”¨æˆ·":u?"ç³»ç»Ÿ":"AIåŠ©æ‰‹"}),e.jsx(I,{type:"secondary",className:"message-time",children:l(a.timestamp)})]}),e.jsxs("div",{className:"message-body",children:[u?e.jsx(I,{className:"system-message",children:a.content}):e.jsx("div",{className:`message-text ${h?"typing-cursor":""}`,children:e.jsx(ze,{children:a.content})}),n(a.toolCalls),s(a.sources)]})]})]},a.id)},i=[...t];return o&&i.push(o),e.jsx("div",{className:"message-list",children:i.map(r)})}const{TextArea:St}=Fe;function _t({systemOnline:t,vectorStoreReady:o}){const[l,n]=m.useState([{id:"welcome",role:"assistant",content:`ğŸ‘‹ æ¬¢è¿ä½¿ç”¨RAG Excelæ™ºèƒ½é—®ç­”ç³»ç»Ÿï¼

è¯·å…ˆä¸Šä¼ Excelæ–‡ä»¶åˆ°å·¦ä¾§çš„æ–‡ä»¶ç®¡ç†å™¨ï¼Œç„¶åå°±å¯ä»¥å¼€å§‹æé—®äº†ã€‚

ğŸ’¡ **ä½¿ç”¨æç¤ºï¼š**
- æ”¯æŒè¯¢é—®Excelä¸­çš„å…·ä½“æ•°æ®
- å¯ä»¥è¿›è¡Œæ•°æ®åˆ†æå’Œç»Ÿè®¡
- æ”¯æŒå¤šæ–‡ä»¶è”åˆæŸ¥è¯¢
- å®æ—¶æ˜¾ç¤ºå·¥å…·è°ƒç”¨è¿‡ç¨‹`,timestamp:new Date().toISOString(),toolCalls:[],sources:[]}]),[s,r]=m.useState(""),[i,a]=m.useState(!1),[d,u]=m.useState(null),h=m.useRef(null),y=m.useRef(null),v=()=>{var f;(f=h.current)==null||f.scrollIntoView({behavior:"smooth"})};m.useEffect(()=>{v()},[l,d]);const S=()=>`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,j=f=>{n(x=>[...x,{...f,id:S()}])},D=(f,x=[],b=[])=>{u({id:"streaming",role:"assistant",content:f,timestamp:new Date().toISOString(),toolCalls:x,sources:b,isStreaming:!0})},k=()=>{d&&(j({...d,isStreaming:!1}),u(null))},c=async()=>{const f=s.trim();if(!(!f||i)){if(!t){j({role:"system",content:"âŒ ç³»ç»Ÿç¦»çº¿ï¼Œè¯·æ£€æŸ¥æœåŠ¡å™¨è¿æ¥çŠ¶æ€",timestamp:new Date().toISOString(),toolCalls:[],sources:[]});return}if(!o){j({role:"system",content:"âš ï¸ å‘é‡æ•°æ®åº“æœªå°±ç»ªï¼Œè¯·å…ˆä¸Šä¼ Excelæ–‡ä»¶",timestamp:new Date().toISOString(),toolCalls:[],sources:[]});return}j({role:"user",content:f,timestamp:new Date().toISOString(),toolCalls:[],sources:[]}),r(""),a(!0);try{const x=await fetch("/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:"rag-excel",messages:[{role:"user",content:f}],temperature:.7,stream:!0})});if(!x.ok)throw new Error(`HTTP ${x.status}: ${x.statusText}`);const b=x.body.getReader(),Ce=new TextDecoder;let W="",Q="",R=[],oe=[];for(;;){const{done:Me,value:Ee}=await b.read();if(Me)break;W+=Ce.decode(Ee,{stream:!0});const ne=W.split(`
`);W=ne.pop();for(const X of ne)if(X.trim()!==""&&X.startsWith("data: ")){const Z=X.slice(6);if(Z.trim()==="[DONE]"){k();break}try{const C=JSON.parse(Z);if(C.choices&&C.choices[0]){const le=C.choices[0],L=le.delta||{};if(L.content&&(Q+=L.content,D(Q,R,oe)),L.tool_calls){for(const M of L.tool_calls)if(M.function&&M.function.name){const ie=R.findIndex(Te=>Te.id===M.id);ie>=0?R[ie]=M:R.push(M),D(Q,[...R],oe)}}if(le.finish_reason==="stop"){k();break}}}catch(C){console.warn("è§£æSSEæ•°æ®å¤±è´¥:",C,Z)}}}}catch(x){console.error("å‘é€æ¶ˆæ¯å¤±è´¥:",x),j({role:"system",content:`âŒ å‘é€å¤±è´¥: ${x.message}`,timestamp:new Date().toISOString(),toolCalls:[],sources:[]}),u(null)}finally{a(!1)}}},p=()=>{n([{id:"welcome",role:"assistant",content:"å¯¹è¯å·²æ¸…ç©ºï¼Œå¯ä»¥å¼€å§‹æ–°çš„æé—®ã€‚",timestamp:new Date().toISOString(),toolCalls:[],sources:[]}]),u(null)},w=f=>{f.key==="Enter"&&!f.shiftKey&&(f.preventDefault(),c())},P=()=>t?o?null:e.jsx(ce,{message:"å‘é‡æ•°æ®åº“æœªå°±ç»ª",description:"è¯·å…ˆä¸Šä¼ Excelæ–‡ä»¶åˆ°å·¦ä¾§æ–‡ä»¶ç®¡ç†å™¨",type:"warning",icon:e.jsx(U,{}),showIcon:!0,className:"system-alert"}):e.jsx(ce,{message:"ç³»ç»Ÿç¦»çº¿",description:"æ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡ï¼Œè¯·æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€",type:"error",icon:e.jsx(U,{}),showIcon:!0,className:"system-alert"});return e.jsxs("div",{className:"chat-panel",children:[P(),e.jsxs("div",{className:"messages-container",children:[l.length===0?e.jsx(ye,{image:e.jsx(F,{style:{fontSize:64,color:"#d9d9d9"}}),description:"æš‚æ— å¯¹è¯æ¶ˆæ¯"}):e.jsx(Nt,{messages:l,streamingMessage:d}),e.jsx("div",{ref:h})]}),e.jsx("div",{className:"input-container",children:e.jsxs("div",{className:"input-wrapper",children:[e.jsx(St,{ref:y,value:s,onChange:f=>r(f.target.value),onKeyPress:w,placeholder:t?o?"è¾“å…¥æ‚¨çš„é—®é¢˜... (Shift+Enteræ¢è¡Œï¼ŒEnterå‘é€)":"è¯·å…ˆä¸Šä¼ Excelæ–‡ä»¶...":"ç³»ç»Ÿç¦»çº¿ï¼Œæ— æ³•å‘é€æ¶ˆæ¯...",disabled:!t||!o||i,autoSize:{minRows:1,maxRows:4},className:"message-input"}),e.jsxs($,{className:"input-actions",children:[e.jsx(E,{title:"æ¸…ç©ºå¯¹è¯",children:e.jsx(T,{icon:e.jsx(Ue,{}),onClick:p,disabled:i||l.length<=1,type:"text"})}),e.jsx(T,{type:"primary",icon:i?e.jsx(se,{size:"small"}):e.jsx(Be,{}),onClick:c,disabled:!s.trim()||!t||!o||i,loading:i,children:"å‘é€"})]})]})})]})}const{Dragger:$t}=Ye,{Text:A}=B;function wt({onFileChange:t,fileCount:o}){const[l,n]=m.useState([]),[s,r]=m.useState(!1),[i,a]=m.useState(!1),[d,u]=m.useState(0),h=m.useRef(null),y=async()=>{r(!0);try{const c=await fetch("/v1/files/list");if(c.ok){const p=await c.json();n(p.files||[])}else _.error("è·å–æ–‡ä»¶åˆ—è¡¨å¤±è´¥")}catch(c){console.error("åŠ è½½æ–‡ä»¶åˆ—è¡¨å¤±è´¥:",c),_.error("ç½‘ç»œé”™è¯¯ï¼Œæ— æ³•è·å–æ–‡ä»¶åˆ—è¡¨")}finally{r(!1)}};m.useEffect(()=>{y()},[o]);const v=c=>{if(c===0)return"0 Bytes";const p=1024,w=["Bytes","KB","MB","GB"],P=Math.floor(Math.log(c)/Math.log(p));return parseFloat((c/Math.pow(p,P)).toFixed(2))+" "+w[P]},S=c=>new Date(c).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),j=async c=>{if(!(c.type==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"||c.type==="application/vnd.ms-excel"||c.name.endsWith(".xlsx")||c.name.endsWith(".xls")))return _.error("åªæ”¯æŒExcelæ–‡ä»¶æ ¼å¼ (.xlsx, .xls)"),!1;const w=10*1024*1024;if(c.size>w)return _.error("æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡10MB"),!1;a(!0),u(0);const P=new FormData;P.append("file",c);try{const f=setInterval(()=>{u(b=>b>=90?(clearInterval(f),b):b+Math.random()*20)},200),x=await fetch("/v1/files/upload",{method:"POST",body:P});if(clearInterval(f),u(100),x.ok){const b=await x.json();_.success(b.message||"æ–‡ä»¶ä¸Šä¼ æˆåŠŸ"),setTimeout(()=>{y(),t==null||t()},1e3)}else{const b=await x.json();_.error(b.detail||"ä¸Šä¼ å¤±è´¥")}}catch(f){console.error("ä¸Šä¼ æ–‡ä»¶å¤±è´¥:",f),_.error("ç½‘ç»œé”™è¯¯ï¼Œä¸Šä¼ å¤±è´¥")}finally{a(!1),u(0)}return!1},D=async c=>{try{const p=await fetch(`/v1/files/${encodeURIComponent(c)}`,{method:"DELETE"});if(p.ok){const w=await p.json();_.success(w.message||"æ–‡ä»¶åˆ é™¤æˆåŠŸ"),y(),t==null||t()}else{const w=await p.json();_.error(w.detail||"åˆ é™¤å¤±è´¥")}}catch(p){console.error("åˆ é™¤æ–‡ä»¶å¤±è´¥:",p),_.error("ç½‘ç»œé”™è¯¯ï¼Œåˆ é™¤å¤±è´¥")}},k={name:"file",multiple:!0,accept:".xlsx,.xls",beforeUpload:j,showUploadList:!1,disabled:i};return e.jsxs("div",{className:"file-manager",children:[e.jsxs("div",{className:"upload-section",children:[e.jsxs($t,{...k,className:"upload-dragger",children:[e.jsx("p",{className:"ant-upload-drag-icon",children:i?e.jsx(se,{size:"large"}):e.jsx(qe,{})}),e.jsx("p",{className:"ant-upload-text",children:i?"æ­£åœ¨ä¸Šä¼ ...":"ç‚¹å‡»æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤åŒºåŸŸä¸Šä¼ "}),e.jsx("p",{className:"ant-upload-hint",children:"æ”¯æŒ .xlsx å’Œ .xls æ ¼å¼ï¼Œå•ä¸ªæ–‡ä»¶ä¸è¶…è¿‡10MB"})]}),i&&e.jsx("div",{className:"upload-progress",children:e.jsx(Ke,{percent:Math.round(d),size:"small",status:"active"})})]}),e.jsxs("div",{className:"files-section",children:[e.jsxs("div",{className:"files-header",children:[e.jsxs($,{children:[e.jsx(A,{strong:!0,children:"çŸ¥è¯†åº“æ–‡ä»¶"}),e.jsxs(N,{color:"blue",children:[l.length," ä¸ªæ–‡ä»¶"]})]}),e.jsx(T,{icon:e.jsx(Ve,{}),size:"small",onClick:y,loading:s,type:"text"})]}),e.jsx("div",{className:"files-list",children:s?e.jsx("div",{className:"loading-container",children:e.jsx(se,{tip:"åŠ è½½ä¸­..."})}):l.length===0?e.jsx(ye,{image:e.jsx(de,{style:{fontSize:48,color:"#d9d9d9"}}),description:"æš‚æ— Excelæ–‡ä»¶",imageStyle:{height:60},children:e.jsx(T,{type:"primary",icon:e.jsx(Ge,{}),onClick:()=>{var c;return(c=h.current)==null?void 0:c.click()},children:"ä¸Šä¼ æ–‡ä»¶"})}):e.jsx(ee,{dataSource:l,renderItem:c=>e.jsx(ee.Item,{className:"file-item",actions:[e.jsx(He,{title:"ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ–‡ä»¶å—ï¼Ÿ",description:"åˆ é™¤åå°†ä»çŸ¥è¯†åº“ä¸­ç§»é™¤ï¼Œæ— æ³•æ¢å¤",onConfirm:()=>D(c.filename),okText:"ç¡®å®š",cancelText:"å–æ¶ˆ",children:e.jsx(T,{icon:e.jsx(Je,{}),size:"small",type:"text",danger:!0})},"delete")],children:e.jsx(ee.Item.Meta,{avatar:e.jsx(de,{className:"file-icon"}),title:e.jsx(A,{className:"file-name",title:c.filename,children:c.filename}),description:e.jsxs($,{direction:"vertical",size:2,children:[e.jsx(A,{type:"secondary",className:"file-size",children:v(c.size)}),e.jsx(A,{type:"secondary",className:"file-date",children:S(c.modified_time)})]})})})})})]}),e.jsx("input",{ref:h,type:"file",accept:".xlsx,.xls",multiple:!0,style:{display:"none"},onChange:c=>{Array.from(c.target.files).forEach(j),c.target.value=""}})]})}const{Text:kt}=B;function Pt({status:t}){const{online:o,vectorStoreReady:l,fileCount:n,lastUpdate:s}=t,r=d=>{if(!d)return"æœªçŸ¥";const u=new Date(d),y=new Date-u,v=Math.floor(y/(1e3*60)),S=Math.floor(v/60),j=Math.floor(S/24);return v<1?"åˆšåˆš":v<60?`${v}åˆ†é’Ÿå‰`:S<24?`${S}å°æ—¶å‰`:j<7?`${j}å¤©å‰`:u.toLocaleDateString("zh-CN")},i=()=>o?l?e.jsx(N,{icon:e.jsx(We,{}),color:"success",className:"status-tag",children:"æ­£å¸¸"}):e.jsx(N,{icon:e.jsx(U,{}),color:"warning",className:"status-tag",children:"æœªå°±ç»ª"}):e.jsx(N,{icon:e.jsx(ue,{}),color:"error",className:"status-tag",children:"ç¦»çº¿"}),a=()=>o?l?e.jsx(N,{icon:e.jsx(Qe,{}),color:"success",size:"small",children:"å°±ç»ª"}):e.jsx(N,{icon:e.jsx(U,{}),color:"warning",size:"small",children:"æœªå°±ç»ª"}):e.jsx(N,{icon:e.jsx(ue,{}),color:"default",size:"small",children:"ç¦»çº¿"});return e.jsx("div",{className:"system-status",children:e.jsxs($,{size:"middle",className:"status-items",children:[e.jsx(E,{title:e.jsxs("div",{children:[e.jsxs("div",{children:["ç³»ç»ŸçŠ¶æ€: ",o?"åœ¨çº¿":"ç¦»çº¿"]}),e.jsxs("div",{children:["å‘é‡åº“: ",l?"å°±ç»ª":"æœªå°±ç»ª"]}),s&&e.jsxs("div",{children:["æœ€åæ›´æ–°: ",r(s)]})]}),placement:"bottomRight",children:e.jsx("div",{className:"status-item",children:i()})}),e.jsx(E,{title:`å‘é‡æ•°æ®åº“${l?"å·²å°±ç»ªï¼Œå¯ä»¥è¿›è¡Œé—®ç­”":"æœªå°±ç»ªï¼Œè¯·å…ˆä¸Šä¼ Excelæ–‡ä»¶"}`,placement:"bottom",children:e.jsx("div",{className:"status-item",children:a()})}),e.jsx(E,{title:`çŸ¥è¯†åº“ä¸­å…±æœ‰ ${n} ä¸ªExcelæ–‡ä»¶`,placement:"bottom",children:e.jsx("div",{className:"status-item",children:e.jsxs(N,{icon:e.jsx(ae,{}),color:"blue",size:"small",children:[n," æ–‡ä»¶"]})})}),s&&e.jsx(E,{title:`å‘é‡åº“æœ€åæ›´æ–°æ—¶é—´: ${new Date(s).toLocaleString("zh-CN")}`,placement:"bottomLeft",children:e.jsx("div",{className:"status-item",children:e.jsx(N,{icon:e.jsx(je,{}),color:"default",size:"small",children:r(s)})})})]})})}const{Header:It,Content:Rt,Footer:Ct}=ve,{Title:Mt,Text:te}=B;function Et(){const[t,o]=m.useState({online:!1,vectorStoreReady:!1,fileCount:0,lastUpdate:null}),[l,n]=m.useState(0),s=()=>{n(r=>r+1)};return m.useEffect(()=>{const r=async()=>{try{const a=await fetch("/health");if(a.ok){const d=await a.json();o({online:!0,vectorStoreReady:d.vector_store_ready,fileCount:d.knowledge_base_files,lastUpdate:d.last_update})}else o(d=>({...d,online:!1}))}catch(a){console.error("ç³»ç»ŸçŠ¶æ€æ£€æŸ¥å¤±è´¥:",a),o(d=>({...d,online:!1}))}};r();const i=setInterval(r,3e4);return()=>clearInterval(i)},[l]),e.jsxs(ve,{className:"app-layout",children:[e.jsx(It,{className:"app-header",children:e.jsxs("div",{className:"header-content",children:[e.jsxs($,{align:"center",size:"large",children:[e.jsxs("div",{className:"logo",children:[e.jsx(F,{className:"logo-icon"}),e.jsx(Mt,{level:3,className:"logo-text",children:"RAG Excel API"})]}),e.jsx(fe,{type:"vertical",className:"header-divider"}),e.jsx(te,{className:"subtitle",children:"æ™ºèƒ½Excelé—®ç­”ç³»ç»Ÿ"})]}),e.jsxs($,{align:"center",children:[e.jsx(Pt,{status:t}),e.jsxs("a",{href:"http://localhost:8000/docs",target:"_blank",rel:"noopener noreferrer",className:"header-link",children:[e.jsx(Xe,{})," APIæ–‡æ¡£"]})]})]})}),e.jsx(Rt,{className:"app-content",children:e.jsx("div",{className:"content-container",children:e.jsxs(Ze,{gutter:[24,24],className:"main-row",children:[e.jsx(me,{xs:24,lg:8,xl:6,children:e.jsx(pe,{title:e.jsxs($,{children:[e.jsx(ae,{}),"æ–‡ä»¶ç®¡ç†"]}),className:"file-manager-card",bodyStyle:{padding:"16px"},children:e.jsx(wt,{onFileChange:s,fileCount:t.fileCount})})}),e.jsx(me,{xs:24,lg:16,xl:18,children:e.jsx(pe,{title:e.jsxs($,{children:[e.jsx(F,{}),"æ™ºèƒ½é—®ç­”"]}),className:"chat-panel-card",bodyStyle:{padding:0},children:e.jsx(_t,{systemOnline:t.online,vectorStoreReady:t.vectorStoreReady})})})]})})}),e.jsx(Ct,{className:"app-footer",children:e.jsx("div",{className:"footer-content",children:e.jsxs($,{split:e.jsx(fe,{type:"vertical"}),children:[e.jsx(te,{type:"secondary",children:"Â© 2024 RAG Excel API - åŸºäºæ£€ç´¢å¢å¼ºç”Ÿæˆçš„æ™ºèƒ½é—®ç­”ç³»ç»Ÿ"}),e.jsxs("a",{href:"https://github.com",target:"_blank",rel:"noopener noreferrer",className:"footer-link",children:[e.jsx(et,{})," GitHub"]}),e.jsx(te,{type:"secondary",children:"Powered by FastAPI + React + Ollama"})]})})})]})}re.createRoot(document.getElementById("root")).render(e.jsx(ke.StrictMode,{children:e.jsx(tt,{locale:bt,theme:{token:{colorPrimary:"#1890ff",borderRadius:8}},children:e.jsx(Et,{})})}));
