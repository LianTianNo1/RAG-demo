import{j as e,M as Ae}from"./utils-D84y-Eax.js";import{c as Le,g as Ue,r as m,R as Fe}from"./vendor-o6zXO7vr.js";import{T as J,C as Se,R as Be,a as $e,b as pe,c as H,S as $,d as v,e as ue,I as Ye,E as _e,f as L,B as U,g as qe,h as ce,i as Ke,A as xe,j as V,U as Ge,k as He,P as Ve,l as Je,m as We,n as he,L as le,o as Qe,p as Xe,s as S,q as ge,r as Ze,t as et,u as we,D as je,v as tt,w as st,x as ye,y as ve,z as rt,F as at}from"./antd-iQvz0gox.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function l(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(r){if(r.ep)return;r.ep=!0;const a=l(r);fetch(r.href,a)}})();var de={},be=Le;de.createRoot=be.createRoot,de.hydrateRoot=be.hydrateRoot;var W={},Pe={exports:{}};(function(t){function n(l){return l&&l.__esModule?l:{default:l}}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports})(Pe);var Q=Pe.exports,X={};Object.defineProperty(X,"__esModule",{value:!0});X.default=void 0;var ot={items_per_page:"条/页",jump_to:"跳至",jump_to_confirm:"确定",page:"页",prev_page:"上一页",next_page:"下一页",prev_5:"向前 5 页",next_5:"向后 5 页",prev_3:"向前 3 页",next_3:"向后 3 页",page_size:"页码"};X.default=ot;var Z={},B={},ee={},Ce={exports:{}},Te={exports:{}},Ie={exports:{}},Me={exports:{}};(function(t){function n(l){"@babel/helpers - typeof";return t.exports=n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},t.exports.__esModule=!0,t.exports.default=t.exports,n(l)}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports})(Me);var Re=Me.exports,Ee={exports:{}};(function(t){var n=Re.default;function l(o,r){if(n(o)!="object"||!o)return o;var a=o[Symbol.toPrimitive];if(a!==void 0){var s=a.call(o,r||"default");if(n(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(o)}t.exports=l,t.exports.__esModule=!0,t.exports.default=t.exports})(Ee);var nt=Ee.exports;(function(t){var n=Re.default,l=nt;function o(r){var a=l(r,"string");return n(a)=="symbol"?a:a+""}t.exports=o,t.exports.__esModule=!0,t.exports.default=t.exports})(Ie);var lt=Ie.exports;(function(t){var n=lt;function l(o,r,a){return(r=n(r))in o?Object.defineProperty(o,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):o[r]=a,o}t.exports=l,t.exports.__esModule=!0,t.exports.default=t.exports})(Te);var it=Te.exports;(function(t){var n=it;function l(r,a){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);a&&(i=i.filter(function(d){return Object.getOwnPropertyDescriptor(r,d).enumerable})),s.push.apply(s,i)}return s}function o(r){for(var a=1;a<arguments.length;a++){var s=arguments[a]!=null?arguments[a]:{};a%2?l(Object(s),!0).forEach(function(i){n(r,i,s[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):l(Object(s)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(s,i))})}return r}t.exports=o,t.exports.__esModule=!0,t.exports.default=t.exports})(Ce);var ct=Ce.exports,te={};Object.defineProperty(te,"__esModule",{value:!0});te.commonLocale=void 0;te.commonLocale={yearFormat:"YYYY",dayFormat:"D",cellMeridiemFormat:"A",monthBeforeYear:!0};var dt=Q.default;Object.defineProperty(ee,"__esModule",{value:!0});ee.default=void 0;var Ne=dt(ct),ut=te,ft=(0,Ne.default)((0,Ne.default)({},ut.commonLocale),{},{locale:"zh_CN",today:"今天",now:"此刻",backToToday:"返回今天",ok:"确定",timeSelect:"选择时间",dateSelect:"选择日期",weekSelect:"选择周",clear:"清除",week:"周",month:"月",year:"年",previousMonth:"上个月 (翻页上键)",nextMonth:"下个月 (翻页下键)",monthSelect:"选择月份",yearSelect:"选择年份",decadeSelect:"选择年代",previousYear:"上一年 (Control键加左方向键)",nextYear:"下一年 (Control键加右方向键)",previousDecade:"上一年代",nextDecade:"下一年代",previousCentury:"上一世纪",nextCentury:"下一世纪",yearFormat:"YYYY年",cellDateFormat:"D",monthBeforeYear:!1});ee.default=ft;var Y={};Object.defineProperty(Y,"__esModule",{value:!0});Y.default=void 0;const mt={placeholder:"请选择时间",rangePlaceholder:["开始时间","结束时间"]};Y.default=mt;var Oe=Q.default;Object.defineProperty(B,"__esModule",{value:!0});B.default=void 0;var pt=Oe(ee),xt=Oe(Y);const ze={lang:Object.assign({placeholder:"请选择日期",yearPlaceholder:"请选择年份",quarterPlaceholder:"请选择季度",monthPlaceholder:"请选择月份",weekPlaceholder:"请选择周",rangePlaceholder:["开始日期","结束日期"],rangeYearPlaceholder:["开始年份","结束年份"],rangeMonthPlaceholder:["开始月份","结束月份"],rangeQuarterPlaceholder:["开始季度","结束季度"],rangeWeekPlaceholder:["开始周","结束周"]},pt.default),timePickerLocale:Object.assign({},xt.default)};ze.lang.ok="确定";B.default=ze;var ht=Q.default;Object.defineProperty(Z,"__esModule",{value:!0});Z.default=void 0;var gt=ht(B);Z.default=gt.default;var se=Q.default;Object.defineProperty(W,"__esModule",{value:!0});W.default=void 0;var jt=se(X),yt=se(Z),vt=se(B),bt=se(Y);const g="${label}不是一个有效的${type}",Nt={locale:"zh-cn",Pagination:jt.default,DatePicker:vt.default,TimePicker:bt.default,Calendar:yt.default,global:{placeholder:"请选择",close:"关闭"},Table:{filterTitle:"筛选",filterConfirm:"确定",filterReset:"重置",filterEmptyText:"无筛选项",filterCheckAll:"全选",filterSearchPlaceholder:"在筛选项中搜索",emptyText:"暂无数据",selectAll:"全选当页",selectInvert:"反选当页",selectNone:"清空所有",selectionAll:"全选所有",sortTitle:"排序",expand:"展开行",collapse:"关闭行",triggerDesc:"点击降序",triggerAsc:"点击升序",cancelSort:"取消排序"},Modal:{okText:"确定",cancelText:"取消",justOkText:"知道了"},Tour:{Next:"下一步",Previous:"上一步",Finish:"结束导览"},Popconfirm:{cancelText:"取消",okText:"确定"},Transfer:{titles:["",""],searchPlaceholder:"请输入搜索内容",itemUnit:"项",itemsUnit:"项",remove:"删除",selectCurrent:"全选当页",removeCurrent:"删除当页",selectAll:"全选所有",deselectAll:"取消全选",removeAll:"删除全部",selectInvert:"反选当页"},Upload:{uploading:"文件上传中",removeFile:"删除文件",uploadError:"上传错误",previewFile:"预览文件",downloadFile:"下载文件"},Empty:{description:"暂无数据"},Icon:{icon:"图标"},Text:{edit:"编辑",copy:"复制",copied:"复制成功",expand:"展开",collapse:"收起"},Form:{optional:"（可选）",defaultValidateMessages:{default:"字段验证错误${label}",required:"请输入${label}",enum:"${label}必须是其中一个[${enum}]",whitespace:"${label}不能为空字符",date:{format:"${label}日期格式无效",parse:"${label}不能转换为日期",invalid:"${label}是一个无效日期"},types:{string:g,method:g,array:g,object:g,number:g,date:g,boolean:g,integer:g,float:g,regexp:g,email:g,url:g,hex:g},string:{len:"${label}须为${len}个字符",min:"${label}最少${min}个字符",max:"${label}最多${max}个字符",range:"${label}须在${min}-${max}字符之间"},number:{len:"${label}必须等于${len}",min:"${label}最小值为${min}",max:"${label}最大值为${max}",range:"${label}须在${min}-${max}之间"},array:{len:"须为${len}个${label}",min:"最少${min}个${label}",max:"最多${max}个${label}",range:"${label}数量须在${min}-${max}之间"},pattern:{mismatch:"${label}与模式不匹配${pattern}"}}},Image:{preview:"预览"},QRCode:{expired:"二维码过期",refresh:"点击刷新",scanned:"已扫描"},ColorPicker:{presetEmpty:"暂无",transparent:"无色",singleColor:"单色",gradientColor:"渐变色"}};W.default=Nt;var St=W;const $t=Ue(St),{Text:I}=J,{Panel:Ut}=Se;function _t({messages:t,streamingMessage:n}){const l=s=>new Date(s).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),o=s=>!s||s.length===0?null:e.jsx("div",{className:"tool-calls-section",children:e.jsx(Se,{size:"small",ghost:!0,items:s.map((i,d)=>{var _,j,y;let u={};try{u=JSON.parse(((_=i.function)==null?void 0:_.arguments)||"{}")}catch{u={raw:((j=i.function)==null?void 0:j.arguments)||""}}return{key:d,label:e.jsxs($,{children:[e.jsx(pe,{}),e.jsx(I,{strong:!0,children:((y=i.function)==null?void 0:y.name)||"unknown"}),e.jsx(v,{color:"blue",size:"small",children:"工具调用"})]}),children:e.jsx("div",{className:"tool-call-content",children:e.jsx(I,{code:!0,className:"tool-args",children:JSON.stringify(u,null,2)})})}})})}),r=s=>!s||s.length===0?null:e.jsxs("div",{className:"sources-section",children:[e.jsxs("div",{className:"sources-header",children:[e.jsx(ue,{}),e.jsx(I,{strong:!0,children:"信息来源"})]}),e.jsx("div",{className:"sources-list",children:s.map((i,d)=>e.jsxs("div",{className:"source-item",children:[e.jsx(v,{color:"green",size:"small",children:i.file}),e.jsxs(I,{type:"secondary",children:["工作表: ",i.sheet]})]},d))})]}),a=s=>{const i=s.role==="user",d=s.role==="system",u=s.role==="tool";return e.jsxs("div",{className:`message-item ${i?"user":d?"system":u?"tool":"assistant"}`,children:[e.jsx("div",{className:"message-avatar",children:i?e.jsx(Be,{}):d?e.jsx($e,{}):u?e.jsx(pe,{}):e.jsx(H,{})}),e.jsxs("div",{className:"message-content",children:[e.jsxs("div",{className:"message-header",children:[e.jsx(I,{strong:!0,className:"message-role",children:i?"用户":d?"系统":u?"工具调用":"AI助手"}),e.jsx(I,{type:"secondary",className:"message-time",children:l(s.timestamp)})]}),e.jsxs("div",{className:"message-body",children:[d?e.jsx(I,{className:"system-message",children:s.content}):u?e.jsxs("div",{className:"tool-message",children:[e.jsx(I,{className:"tool-message-text",children:s.content}),o(s.toolCalls)]}):e.jsx("div",{className:"message-text",children:e.jsx(Ae,{children:s.content})}),!u&&o(s.toolCalls),r(s.sources)]})]})]},s.id)};return e.jsx("div",{className:"message-list",children:t.map(a)})}const wt="http://localhost:8000",F=(t,n)=>{const l={"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, POST, PUT, DELETE, OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization"},o={...n,headers:{...(n==null?void 0:n.headers)||{},...l}};return fetch(`${wt}${t}`,o)},{TextArea:Pt}=Ye;function Ct({systemOnline:t,vectorStoreReady:n}){const[l,o]=m.useState([{id:"welcome",role:"assistant",content:`👋 欢迎使用RAG Excel智能问答系统！

请先上传Excel文件到左侧的文件管理器，然后就可以开始提问了。

💡 **使用提示：**
- 支持询问Excel中的具体数据
- 可以进行数据分析和统计
- 支持多文件联合查询
- 实时显示工具调用过程`,timestamp:new Date().toISOString(),toolCalls:[],sources:[]}]),[r,a]=m.useState(""),[s,i]=m.useState(!1),[d,u]=m.useState(null),_=m.useRef(null),j=m.useRef(null),y=()=>{var f;(f=_.current)==null||f.scrollIntoView({behavior:"smooth"})};m.useEffect(()=>{y()},[l.length]);const w=()=>`msg_${Date.now()}_${Math.random().toString(36).slice(2,11)}`,b=f=>{o(h=>[...h,{...f,id:w()}])},E=(f,h=[],x=[],re=!1)=>{const D={id:w(),role:"assistant",content:f,timestamp:new Date().toISOString(),toolCalls:h,sources:x,isStreaming:!0,isTyping:re};u(D),o(C=>C[C.length-1].role==="assistant"?[...C.slice(0,-1),D]:[...C,D])},q=()=>{},c=async()=>{const f=r.trim();if(!(!f||s)){if(!t){b({role:"system",content:"❌ 系统离线，请检查服务器连接状态",timestamp:new Date().toISOString(),toolCalls:[],sources:[]});return}if(!n){b({role:"system",content:"⚠️ 向量数据库未就绪，请先上传Excel文件",timestamp:new Date().toISOString(),toolCalls:[],sources:[]});return}a(""),i(!0),u(null);try{const h=l.filter(R=>R.role==="user"||R.role==="assistant").map(R=>({role:R.role,content:R.content}));h.push({role:"user",content:f}),b({role:"user",content:f,timestamp:new Date().toISOString(),toolCalls:[],sources:[]});const x=await F("/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:"rag-excel",messages:h,temperature:.7,stream:!0})});if(!x.ok)throw new Error(`HTTP ${x.status}: ${x.statusText}`);const re=x.body.getReader(),D=new TextDecoder;let C="",O="",T=[],k=[],ae=!1;for(E("🤖 正在思考...",[],[],!0);;){const{done:R,value:De}=await re.read();if(R)break;C+=D.decode(De,{stream:!0});const fe=C.split(`
`);C=fe.pop();for(const oe of fe)if(oe.trim()!==""&&oe.startsWith("data: ")){const ne=oe.slice(6);if(ne.trim()==="[DONE]"){setTimeout(()=>{q()},500);break}try{const A=JSON.parse(ne);if(A.choices&&A.choices[0]){const me=A.choices[0],K=me.delta||{};if(K.tool_calls){for(const N of K.tool_calls)if(N.function&&N.function.name){const z=T.findIndex(ke=>ke.id===N.id);z>=0?T[z]=N:T.push(N)}if(T.length>0&&!ae){const N=T.map(z=>z.function.name).join(", ");E(`🔧 使用工具: ${N}`,T,k,!0)}}if(K.content&&(ae||(O="",ae=!0),O+=K.content,E(O,T,k,!0)),me.finish_reason==="stop"){k.length>0&&(O+=`

📚 **信息来源:**
`,k.forEach((N,z)=>{O+=`${z+1}. 文件: ${N.file}, 工作表: ${N.sheet}
`})),E(O,T,k,!1),setTimeout(()=>{q()},500);break}}}catch(A){console.warn("解析SSE数据失败:",A,ne)}}}}catch(h){console.error("发送消息失败:",h),b({role:"system",content:`❌ 发送失败: ${h.message}`,timestamp:new Date().toISOString(),toolCalls:[],sources:[]}),u(null)}finally{i(!1)}}},p=()=>{o([{id:"welcome",role:"assistant",content:"对话已清空，可以开始新的提问。",timestamp:new Date().toISOString(),toolCalls:[],sources:[]}]),u(null)},P=f=>{f.key==="Enter"&&!f.shiftKey&&(f.preventDefault(),c())},M=()=>t?n?null:e.jsx(xe,{message:"向量数据库未就绪",description:"请先上传Excel文件到左侧文件管理器",type:"warning",icon:e.jsx(V,{}),showIcon:!0,className:"system-alert"}):e.jsx(xe,{message:"系统离线",description:"无法连接到后端服务，请检查服务器状态",type:"error",icon:e.jsx(V,{}),showIcon:!0,className:"system-alert"});return e.jsxs("div",{className:"chat-panel",children:[M(),e.jsxs("div",{className:"messages-container",children:[l.length===0?e.jsx(_e,{image:e.jsx(H,{style:{fontSize:64,color:"#d9d9d9"}}),description:"暂无对话消息"}):e.jsx(_t,{messages:l,streamingMessage:d}),e.jsx("div",{ref:_})]}),e.jsx("div",{className:"input-container",children:e.jsxs("div",{className:"input-wrapper",children:[e.jsx(Pt,{ref:j,value:r,onChange:f=>a(f.target.value),onKeyPress:P,placeholder:t?n?"输入您的问题... (Shift+Enter换行，Enter发送)":"请先上传Excel文件...":"系统离线，无法发送消息...",disabled:!t||!n||s,autoSize:{minRows:1,maxRows:4},className:"message-input"}),e.jsxs($,{className:"input-actions",children:[e.jsx(L,{title:"清空对话",children:e.jsx(U,{icon:e.jsx(qe,{}),onClick:p,disabled:s||l.length<=1,type:"text"})}),e.jsx(U,{type:"primary",icon:s?e.jsx(ce,{size:"small"}):e.jsx(Ke,{}),onClick:c,disabled:!r.trim()||!t||!n||s,loading:s,children:"发送"})]})]})})]})}const{Dragger:Tt}=Ge,{Text:G}=J;function It({onFileChange:t,fileCount:n}){const[l,o]=m.useState([]),[r,a]=m.useState(!1),[s,i]=m.useState(!1),[d,u]=m.useState(0),_=m.useRef(null),j=async()=>{a(!0);try{const c=await F("/v1/files/list");if(c.ok){const p=await c.json();o(p.files||[])}else S.error("获取文件列表失败")}catch(c){console.error("加载文件列表失败:",c),S.error("网络错误，无法获取文件列表")}finally{a(!1)}};m.useEffect(()=>{j()},[n]);const y=c=>{if(c===0)return"0 Bytes";const p=1024,P=["Bytes","KB","MB","GB"],M=Math.floor(Math.log(c)/Math.log(p));return parseFloat((c/Math.pow(p,M)).toFixed(2))+" "+P[M]},w=c=>new Date(c).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),b=async c=>{if(!(c.type==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"||c.type==="application/vnd.ms-excel"||c.name.endsWith(".xlsx")||c.name.endsWith(".xls")))return S.error("只支持Excel文件格式 (.xlsx, .xls)"),!1;const P=10*1024*1024;if(c.size>P)return S.error("文件大小不能超过10MB"),!1;i(!0),u(0);const M=new FormData;M.append("file",c);try{const f=setInterval(()=>{u(x=>x>=90?(clearInterval(f),x):x+Math.random()*20)},200),h=await F("/v1/files/upload",{method:"POST",body:M});if(clearInterval(f),u(100),h.ok){const x=await h.json();S.success(x.message||"文件上传成功"),setTimeout(()=>{j(),t==null||t()},1e3)}else{const x=await h.json();S.error(x.detail||"上传失败")}}catch(f){console.error("上传文件失败:",f),S.error("网络错误，上传失败")}finally{i(!1),u(0)}return!1},E=async c=>{try{const p=await F(`/v1/files/${encodeURIComponent(c)}`,{method:"DELETE"});if(p.ok){const P=await p.json();S.success(P.message||"文件删除成功"),j(),t==null||t()}else{const P=await p.json();S.error(P.detail||"删除失败")}}catch(p){console.error("删除文件失败:",p),S.error("网络错误，删除失败")}},q={name:"file",multiple:!0,accept:".xlsx,.xls",beforeUpload:b,showUploadList:!1,disabled:s};return e.jsxs("div",{className:"file-manager",children:[e.jsxs("div",{className:"upload-section",children:[e.jsxs(Tt,{...q,className:"upload-dragger",children:[e.jsx("p",{className:"ant-upload-drag-icon",children:s?e.jsx(ce,{size:"large"}):e.jsx(He,{})}),e.jsx("p",{className:"ant-upload-text",children:s?"正在上传...":"点击或拖拽文件到此区域上传"}),e.jsx("p",{className:"ant-upload-hint",children:"支持 .xlsx 和 .xls 格式，单个文件不超过10MB"})]}),s&&e.jsx("div",{className:"upload-progress",children:e.jsx(Ve,{percent:Math.round(d),size:"small",status:"active"})})]}),e.jsxs("div",{className:"files-section",children:[e.jsxs("div",{className:"files-header",children:[e.jsxs($,{children:[e.jsx(G,{strong:!0,children:"知识库文件"}),e.jsxs(v,{color:"blue",children:[l.length," 个文件"]})]}),e.jsx(U,{icon:e.jsx(Je,{}),size:"small",onClick:j,loading:r,type:"text"})]}),e.jsx("div",{className:"files-list",children:r?e.jsx("div",{className:"loading-container",children:e.jsx(ce,{tip:"加载中..."})}):l.length===0?e.jsx(_e,{image:e.jsx(he,{style:{fontSize:48,color:"#d9d9d9"}}),description:"暂无Excel文件",imageStyle:{height:60},children:e.jsx(U,{type:"primary",icon:e.jsx(We,{}),onClick:()=>{var c;return(c=_.current)==null?void 0:c.click()},children:"上传文件"})}):e.jsx(le,{dataSource:l,renderItem:c=>e.jsx(le.Item,{className:"file-item",actions:[e.jsx(Qe,{title:"确定要删除这个文件吗？",description:"删除后将从知识库中移除，无法恢复",onConfirm:()=>E(c.filename),okText:"确定",cancelText:"取消",children:e.jsx(U,{icon:e.jsx(Xe,{}),size:"small",type:"text",danger:!0})},"delete")],children:e.jsx(le.Item.Meta,{avatar:e.jsx(he,{className:"file-icon"}),title:e.jsx(G,{className:"file-name",title:c.filename,children:c.filename}),description:e.jsxs($,{direction:"vertical",size:2,children:[e.jsx(G,{type:"secondary",className:"file-size",children:y(c.size)}),e.jsx(G,{type:"secondary",className:"file-date",children:w(c.modified_time)})]})})})})})]}),e.jsx("input",{ref:_,type:"file",accept:".xlsx,.xls",multiple:!0,style:{display:"none"},onChange:c=>{Array.from(c.target.files).forEach(b),c.target.value=""}})]})}const{Text:Ft}=J;function Mt({status:t}){const{online:n,vectorStoreReady:l,fileCount:o,lastUpdate:r}=t,a=d=>{if(!d)return"未知";const u=new Date(d),j=new Date-u,y=Math.floor(j/(1e3*60)),w=Math.floor(y/60),b=Math.floor(w/24);return y<1?"刚刚":y<60?`${y}分钟前`:w<24?`${w}小时前`:b<7?`${b}天前`:u.toLocaleDateString("zh-CN")},s=()=>n?l?e.jsx(v,{icon:e.jsx(Ze,{}),color:"success",className:"status-tag",children:"正常"}):e.jsx(v,{icon:e.jsx(V,{}),color:"warning",className:"status-tag",children:"未就绪"}):e.jsx(v,{icon:e.jsx(ge,{}),color:"error",className:"status-tag",children:"离线"}),i=()=>n?l?e.jsx(v,{icon:e.jsx(et,{}),color:"success",size:"small",children:"就绪"}):e.jsx(v,{icon:e.jsx(V,{}),color:"warning",size:"small",children:"未就绪"}):e.jsx(v,{icon:e.jsx(ge,{}),color:"default",size:"small",children:"离线"});return e.jsx("div",{className:"system-status",children:e.jsxs($,{size:"middle",className:"status-items",children:[e.jsx(L,{title:e.jsxs("div",{children:[e.jsxs("div",{children:["系统状态: ",n?"在线":"离线"]}),e.jsxs("div",{children:["向量库: ",l?"就绪":"未就绪"]}),r&&e.jsxs("div",{children:["最后更新: ",a(r)]})]}),placement:"bottomRight",children:e.jsx("div",{className:"status-item",children:s()})}),e.jsx(L,{title:`向量数据库${l?"已就绪，可以进行问答":"未就绪，请先上传Excel文件"}`,placement:"bottom",children:e.jsx("div",{className:"status-item",children:i()})}),e.jsx(L,{title:`知识库中共有 ${o} 个Excel文件`,placement:"bottom",children:e.jsx("div",{className:"status-item",children:e.jsxs(v,{icon:e.jsx(ue,{}),color:"blue",size:"small",children:[o," 文件"]})})}),r&&e.jsx(L,{title:`向量库最后更新时间: ${new Date(r).toLocaleString("zh-CN")}`,placement:"bottomLeft",children:e.jsx("div",{className:"status-item",children:e.jsx(v,{icon:e.jsx($e,{}),color:"default",size:"small",children:a(r)})})})]})})}const{Header:Rt,Content:Et,Footer:Ot}=we,{Title:zt,Text:ie}=J;function Dt(){const[t,n]=m.useState({online:!1,vectorStoreReady:!1,fileCount:0,lastUpdate:null}),[l,o]=m.useState(0),r=()=>{o(a=>a+1)};return m.useEffect(()=>{const a=async()=>{try{const i=await F("/health");if(i.ok){const d=await i.json();n({online:!0,vectorStoreReady:d.vector_store_ready,fileCount:d.knowledge_base_files,lastUpdate:d.last_update})}else n(d=>({...d,online:!1}))}catch(i){console.error("系统状态检查失败:",i),n(d=>({...d,online:!1}))}};a();const s=setInterval(a,3e4);return()=>clearInterval(s)},[l]),e.jsxs(we,{className:"app-layout",children:[e.jsx(Rt,{className:"app-header",children:e.jsxs("div",{className:"header-content",children:[e.jsxs($,{align:"center",size:"large",children:[e.jsxs("div",{className:"logo",children:[e.jsx(H,{className:"logo-icon"}),e.jsx(zt,{level:3,className:"logo-text",children:"RAG Excel API"})]}),e.jsx(je,{type:"vertical",className:"header-divider"}),e.jsx(ie,{className:"subtitle",children:"智能Excel问答系统"})]}),e.jsxs($,{align:"center",children:[e.jsx(Mt,{status:t}),e.jsxs("a",{href:"http://localhost:8000/docs",target:"_blank",rel:"noopener noreferrer",className:"header-link",children:[e.jsx(tt,{})," API文档"]})]})]})}),e.jsx(Et,{className:"app-content",children:e.jsx("div",{className:"content-container",children:e.jsxs(st,{gutter:[24,24],className:"main-row",children:[e.jsx(ye,{xs:24,lg:8,xl:6,children:e.jsx(ve,{title:e.jsxs($,{children:[e.jsx(ue,{}),"文件管理"]}),className:"file-manager-card",bodyStyle:{padding:"16px"},children:e.jsx(It,{onFileChange:r,fileCount:t.fileCount})})}),e.jsx(ye,{xs:24,lg:16,xl:18,children:e.jsx(ve,{title:e.jsxs($,{children:[e.jsx(H,{}),"智能问答"]}),className:"chat-panel-card",bodyStyle:{padding:0},children:e.jsx(Ct,{systemOnline:t.online,vectorStoreReady:t.vectorStoreReady})})})]})})}),e.jsx(Ot,{className:"app-footer",children:e.jsx("div",{className:"footer-content",children:e.jsxs($,{split:e.jsx(je,{type:"vertical"}),children:[e.jsx(ie,{type:"secondary",children:"© 2024 RAG Excel API - 基于检索增强生成的智能问答系统"}),e.jsxs("a",{href:"https://github.com",target:"_blank",rel:"noopener noreferrer",className:"footer-link",children:[e.jsx(rt,{})," GitHub"]}),e.jsx(ie,{type:"secondary",children:"Powered by FastAPI + React + Ollama"})]})})})]})}de.createRoot(document.getElementById("root")).render(e.jsx(Fe.StrictMode,{children:e.jsx(at,{locale:$t,theme:{token:{colorPrimary:"#1890ff",borderRadius:8}},children:e.jsx(Dt,{})})}));
