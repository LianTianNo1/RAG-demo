import{j as e,M as Ae}from"./utils-D84y-Eax.js";import{c as Le,g as Ue,r as m,R as Fe}from"./vendor-o6zXO7vr.js";import{T as J,C as Se,R as Be,a as $e,b as pe,c as H,S as $,d as v,e as ue,I as Ye,E as _e,f as L,B as U,g as qe,h as ce,i as Ke,A as xe,j as V,U as Ge,k as He,P as Ve,l as Je,m as We,n as he,L as le,o as Qe,p as Xe,s as S,q as ge,r as Ze,t as et,u as we,D as je,v as tt,w as st,x as ye,y as ve,z as rt,F as at}from"./antd-iQvz0gox.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function l(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(r){if(r.ep)return;r.ep=!0;const a=l(r);fetch(r.href,a)}})();var de={},be=Le;de.createRoot=be.createRoot,de.hydrateRoot=be.hydrateRoot;var W={},Pe={exports:{}};(function(t){function n(l){return l&&l.__esModule?l:{default:l}}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports})(Pe);var Q=Pe.exports,X={};Object.defineProperty(X,"__esModule",{value:!0});X.default=void 0;var ot={items_per_page:"æ¡/é¡µ",jump_to:"è·³è‡³",jump_to_confirm:"ç¡®å®š",page:"é¡µ",prev_page:"ä¸Šä¸€é¡µ",next_page:"ä¸‹ä¸€é¡µ",prev_5:"å‘å‰ 5 é¡µ",next_5:"å‘å 5 é¡µ",prev_3:"å‘å‰ 3 é¡µ",next_3:"å‘å 3 é¡µ",page_size:"é¡µç "};X.default=ot;var Z={},B={},ee={},Ce={exports:{}},Te={exports:{}},Ie={exports:{}},Me={exports:{}};(function(t){function n(l){"@babel/helpers - typeof";return t.exports=n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},t.exports.__esModule=!0,t.exports.default=t.exports,n(l)}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports})(Me);var Re=Me.exports,Ee={exports:{}};(function(t){var n=Re.default;function l(o,r){if(n(o)!="object"||!o)return o;var a=o[Symbol.toPrimitive];if(a!==void 0){var s=a.call(o,r||"default");if(n(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(o)}t.exports=l,t.exports.__esModule=!0,t.exports.default=t.exports})(Ee);var nt=Ee.exports;(function(t){var n=Re.default,l=nt;function o(r){var a=l(r,"string");return n(a)=="symbol"?a:a+""}t.exports=o,t.exports.__esModule=!0,t.exports.default=t.exports})(Ie);var lt=Ie.exports;(function(t){var n=lt;function l(o,r,a){return(r=n(r))in o?Object.defineProperty(o,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):o[r]=a,o}t.exports=l,t.exports.__esModule=!0,t.exports.default=t.exports})(Te);var it=Te.exports;(function(t){var n=it;function l(r,a){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);a&&(i=i.filter(function(d){return Object.getOwnPropertyDescriptor(r,d).enumerable})),s.push.apply(s,i)}return s}function o(r){for(var a=1;a<arguments.length;a++){var s=arguments[a]!=null?arguments[a]:{};a%2?l(Object(s),!0).forEach(function(i){n(r,i,s[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):l(Object(s)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(s,i))})}return r}t.exports=o,t.exports.__esModule=!0,t.exports.default=t.exports})(Ce);var ct=Ce.exports,te={};Object.defineProperty(te,"__esModule",{value:!0});te.commonLocale=void 0;te.commonLocale={yearFormat:"YYYY",dayFormat:"D",cellMeridiemFormat:"A",monthBeforeYear:!0};var dt=Q.default;Object.defineProperty(ee,"__esModule",{value:!0});ee.default=void 0;var Ne=dt(ct),ut=te,ft=(0,Ne.default)((0,Ne.default)({},ut.commonLocale),{},{locale:"zh_CN",today:"ä»Šå¤©",now:"æ­¤åˆ»",backToToday:"è¿”å›ä»Šå¤©",ok:"ç¡®å®š",timeSelect:"é€‰æ‹©æ—¶é—´",dateSelect:"é€‰æ‹©æ—¥æœŸ",weekSelect:"é€‰æ‹©å‘¨",clear:"æ¸…é™¤",week:"å‘¨",month:"æœˆ",year:"å¹´",previousMonth:"ä¸Šä¸ªæœˆ (ç¿»é¡µä¸Šé”®)",nextMonth:"ä¸‹ä¸ªæœˆ (ç¿»é¡µä¸‹é”®)",monthSelect:"é€‰æ‹©æœˆä»½",yearSelect:"é€‰æ‹©å¹´ä»½",decadeSelect:"é€‰æ‹©å¹´ä»£",previousYear:"ä¸Šä¸€å¹´ (Controlé”®åŠ å·¦æ–¹å‘é”®)",nextYear:"ä¸‹ä¸€å¹´ (Controlé”®åŠ å³æ–¹å‘é”®)",previousDecade:"ä¸Šä¸€å¹´ä»£",nextDecade:"ä¸‹ä¸€å¹´ä»£",previousCentury:"ä¸Šä¸€ä¸–çºª",nextCentury:"ä¸‹ä¸€ä¸–çºª",yearFormat:"YYYYå¹´",cellDateFormat:"D",monthBeforeYear:!1});ee.default=ft;var Y={};Object.defineProperty(Y,"__esModule",{value:!0});Y.default=void 0;const mt={placeholder:"è¯·é€‰æ‹©æ—¶é—´",rangePlaceholder:["å¼€å§‹æ—¶é—´","ç»“æŸæ—¶é—´"]};Y.default=mt;var Oe=Q.default;Object.defineProperty(B,"__esModule",{value:!0});B.default=void 0;var pt=Oe(ee),xt=Oe(Y);const ze={lang:Object.assign({placeholder:"è¯·é€‰æ‹©æ—¥æœŸ",yearPlaceholder:"è¯·é€‰æ‹©å¹´ä»½",quarterPlaceholder:"è¯·é€‰æ‹©å­£åº¦",monthPlaceholder:"è¯·é€‰æ‹©æœˆä»½",weekPlaceholder:"è¯·é€‰æ‹©å‘¨",rangePlaceholder:["å¼€å§‹æ—¥æœŸ","ç»“æŸæ—¥æœŸ"],rangeYearPlaceholder:["å¼€å§‹å¹´ä»½","ç»“æŸå¹´ä»½"],rangeMonthPlaceholder:["å¼€å§‹æœˆä»½","ç»“æŸæœˆä»½"],rangeQuarterPlaceholder:["å¼€å§‹å­£åº¦","ç»“æŸå­£åº¦"],rangeWeekPlaceholder:["å¼€å§‹å‘¨","ç»“æŸå‘¨"]},pt.default),timePickerLocale:Object.assign({},xt.default)};ze.lang.ok="ç¡®å®š";B.default=ze;var ht=Q.default;Object.defineProperty(Z,"__esModule",{value:!0});Z.default=void 0;var gt=ht(B);Z.default=gt.default;var se=Q.default;Object.defineProperty(W,"__esModule",{value:!0});W.default=void 0;var jt=se(X),yt=se(Z),vt=se(B),bt=se(Y);const g="${label}ä¸æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„${type}",Nt={locale:"zh-cn",Pagination:jt.default,DatePicker:vt.default,TimePicker:bt.default,Calendar:yt.default,global:{placeholder:"è¯·é€‰æ‹©",close:"å…³é—­"},Table:{filterTitle:"ç­›é€‰",filterConfirm:"ç¡®å®š",filterReset:"é‡ç½®",filterEmptyText:"æ— ç­›é€‰é¡¹",filterCheckAll:"å…¨é€‰",filterSearchPlaceholder:"åœ¨ç­›é€‰é¡¹ä¸­æœç´¢",emptyText:"æš‚æ— æ•°æ®",selectAll:"å…¨é€‰å½“é¡µ",selectInvert:"åé€‰å½“é¡µ",selectNone:"æ¸…ç©ºæ‰€æœ‰",selectionAll:"å…¨é€‰æ‰€æœ‰",sortTitle:"æ’åº",expand:"å±•å¼€è¡Œ",collapse:"å…³é—­è¡Œ",triggerDesc:"ç‚¹å‡»é™åº",triggerAsc:"ç‚¹å‡»å‡åº",cancelSort:"å–æ¶ˆæ’åº"},Modal:{okText:"ç¡®å®š",cancelText:"å–æ¶ˆ",justOkText:"çŸ¥é“äº†"},Tour:{Next:"ä¸‹ä¸€æ­¥",Previous:"ä¸Šä¸€æ­¥",Finish:"ç»“æŸå¯¼è§ˆ"},Popconfirm:{cancelText:"å–æ¶ˆ",okText:"ç¡®å®š"},Transfer:{titles:["",""],searchPlaceholder:"è¯·è¾“å…¥æœç´¢å†…å®¹",itemUnit:"é¡¹",itemsUnit:"é¡¹",remove:"åˆ é™¤",selectCurrent:"å…¨é€‰å½“é¡µ",removeCurrent:"åˆ é™¤å½“é¡µ",selectAll:"å…¨é€‰æ‰€æœ‰",deselectAll:"å–æ¶ˆå…¨é€‰",removeAll:"åˆ é™¤å…¨éƒ¨",selectInvert:"åé€‰å½“é¡µ"},Upload:{uploading:"æ–‡ä»¶ä¸Šä¼ ä¸­",removeFile:"åˆ é™¤æ–‡ä»¶",uploadError:"ä¸Šä¼ é”™è¯¯",previewFile:"é¢„è§ˆæ–‡ä»¶",downloadFile:"ä¸‹è½½æ–‡ä»¶"},Empty:{description:"æš‚æ— æ•°æ®"},Icon:{icon:"å›¾æ ‡"},Text:{edit:"ç¼–è¾‘",copy:"å¤åˆ¶",copied:"å¤åˆ¶æˆåŠŸ",expand:"å±•å¼€",collapse:"æ”¶èµ·"},Form:{optional:"ï¼ˆå¯é€‰ï¼‰",defaultValidateMessages:{default:"å­—æ®µéªŒè¯é”™è¯¯${label}",required:"è¯·è¾“å…¥${label}",enum:"${label}å¿…é¡»æ˜¯å…¶ä¸­ä¸€ä¸ª[${enum}]",whitespace:"${label}ä¸èƒ½ä¸ºç©ºå­—ç¬¦",date:{format:"${label}æ—¥æœŸæ ¼å¼æ— æ•ˆ",parse:"${label}ä¸èƒ½è½¬æ¢ä¸ºæ—¥æœŸ",invalid:"${label}æ˜¯ä¸€ä¸ªæ— æ•ˆæ—¥æœŸ"},types:{string:g,method:g,array:g,object:g,number:g,date:g,boolean:g,integer:g,float:g,regexp:g,email:g,url:g,hex:g},string:{len:"${label}é¡»ä¸º${len}ä¸ªå­—ç¬¦",min:"${label}æœ€å°‘${min}ä¸ªå­—ç¬¦",max:"${label}æœ€å¤š${max}ä¸ªå­—ç¬¦",range:"${label}é¡»åœ¨${min}-${max}å­—ç¬¦ä¹‹é—´"},number:{len:"${label}å¿…é¡»ç­‰äº${len}",min:"${label}æœ€å°å€¼ä¸º${min}",max:"${label}æœ€å¤§å€¼ä¸º${max}",range:"${label}é¡»åœ¨${min}-${max}ä¹‹é—´"},array:{len:"é¡»ä¸º${len}ä¸ª${label}",min:"æœ€å°‘${min}ä¸ª${label}",max:"æœ€å¤š${max}ä¸ª${label}",range:"${label}æ•°é‡é¡»åœ¨${min}-${max}ä¹‹é—´"},pattern:{mismatch:"${label}ä¸æ¨¡å¼ä¸åŒ¹é…${pattern}"}}},Image:{preview:"é¢„è§ˆ"},QRCode:{expired:"äºŒç»´ç è¿‡æœŸ",refresh:"ç‚¹å‡»åˆ·æ–°",scanned:"å·²æ‰«æ"},ColorPicker:{presetEmpty:"æš‚æ— ",transparent:"æ— è‰²",singleColor:"å•è‰²",gradientColor:"æ¸å˜è‰²"}};W.default=Nt;var St=W;const $t=Ue(St),{Text:I}=J,{Panel:Ut}=Se;function _t({messages:t,streamingMessage:n}){const l=s=>new Date(s).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),o=s=>!s||s.length===0?null:e.jsx("div",{className:"tool-calls-section",children:e.jsx(Se,{size:"small",ghost:!0,items:s.map((i,d)=>{var _,j,y;let u={};try{u=JSON.parse(((_=i.function)==null?void 0:_.arguments)||"{}")}catch{u={raw:((j=i.function)==null?void 0:j.arguments)||""}}return{key:d,label:e.jsxs($,{children:[e.jsx(pe,{}),e.jsx(I,{strong:!0,children:((y=i.function)==null?void 0:y.name)||"unknown"}),e.jsx(v,{color:"blue",size:"small",children:"å·¥å…·è°ƒç”¨"})]}),children:e.jsx("div",{className:"tool-call-content",children:e.jsx(I,{code:!0,className:"tool-args",children:JSON.stringify(u,null,2)})})}})})}),r=s=>!s||s.length===0?null:e.jsxs("div",{className:"sources-section",children:[e.jsxs("div",{className:"sources-header",children:[e.jsx(ue,{}),e.jsx(I,{strong:!0,children:"ä¿¡æ¯æ¥æº"})]}),e.jsx("div",{className:"sources-list",children:s.map((i,d)=>e.jsxs("div",{className:"source-item",children:[e.jsx(v,{color:"green",size:"small",children:i.file}),e.jsxs(I,{type:"secondary",children:["å·¥ä½œè¡¨: ",i.sheet]})]},d))})]}),a=s=>{const i=s.role==="user",d=s.role==="system",u=s.role==="tool";return e.jsxs("div",{className:`message-item ${i?"user":d?"system":u?"tool":"assistant"}`,children:[e.jsx("div",{className:"message-avatar",children:i?e.jsx(Be,{}):d?e.jsx($e,{}):u?e.jsx(pe,{}):e.jsx(H,{})}),e.jsxs("div",{className:"message-content",children:[e.jsxs("div",{className:"message-header",children:[e.jsx(I,{strong:!0,className:"message-role",children:i?"ç”¨æˆ·":d?"ç³»ç»Ÿ":u?"å·¥å…·è°ƒç”¨":"AIåŠ©æ‰‹"}),e.jsx(I,{type:"secondary",className:"message-time",children:l(s.timestamp)})]}),e.jsxs("div",{className:"message-body",children:[d?e.jsx(I,{className:"system-message",children:s.content}):u?e.jsxs("div",{className:"tool-message",children:[e.jsx(I,{className:"tool-message-text",children:s.content}),o(s.toolCalls)]}):e.jsx("div",{className:"message-text",children:e.jsx(Ae,{children:s.content})}),!u&&o(s.toolCalls),r(s.sources)]})]})]},s.id)};return e.jsx("div",{className:"message-list",children:t.map(a)})}const wt="http://localhost:8000",F=(t,n)=>{const l={"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, POST, PUT, DELETE, OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization"},o={...n,headers:{...(n==null?void 0:n.headers)||{},...l}};return fetch(`${wt}${t}`,o)},{TextArea:Pt}=Ye;function Ct({systemOnline:t,vectorStoreReady:n}){const[l,o]=m.useState([{id:"welcome",role:"assistant",content:`ğŸ‘‹ æ¬¢è¿ä½¿ç”¨RAG Excelæ™ºèƒ½é—®ç­”ç³»ç»Ÿï¼

è¯·å…ˆä¸Šä¼ Excelæ–‡ä»¶åˆ°å·¦ä¾§çš„æ–‡ä»¶ç®¡ç†å™¨ï¼Œç„¶åå°±å¯ä»¥å¼€å§‹æé—®äº†ã€‚

ğŸ’¡ **ä½¿ç”¨æç¤ºï¼š**
- æ”¯æŒè¯¢é—®Excelä¸­çš„å…·ä½“æ•°æ®
- å¯ä»¥è¿›è¡Œæ•°æ®åˆ†æå’Œç»Ÿè®¡
- æ”¯æŒå¤šæ–‡ä»¶è”åˆæŸ¥è¯¢
- å®æ—¶æ˜¾ç¤ºå·¥å…·è°ƒç”¨è¿‡ç¨‹`,timestamp:new Date().toISOString(),toolCalls:[],sources:[]}]),[r,a]=m.useState(""),[s,i]=m.useState(!1),[d,u]=m.useState(null),_=m.useRef(null),j=m.useRef(null),y=()=>{var f;(f=_.current)==null||f.scrollIntoView({behavior:"smooth"})};m.useEffect(()=>{y()},[l.length]);const w=()=>`msg_${Date.now()}_${Math.random().toString(36).slice(2,11)}`,b=f=>{o(h=>[...h,{...f,id:w()}])},E=(f,h=[],x=[],re=!1)=>{const D={id:w(),role:"assistant",content:f,timestamp:new Date().toISOString(),toolCalls:h,sources:x,isStreaming:!0,isTyping:re};u(D),o(C=>C[C.length-1].role==="assistant"?[...C.slice(0,-1),D]:[...C,D])},q=()=>{},c=async()=>{const f=r.trim();if(!(!f||s)){if(!t){b({role:"system",content:"âŒ ç³»ç»Ÿç¦»çº¿ï¼Œè¯·æ£€æŸ¥æœåŠ¡å™¨è¿æ¥çŠ¶æ€",timestamp:new Date().toISOString(),toolCalls:[],sources:[]});return}if(!n){b({role:"system",content:"âš ï¸ å‘é‡æ•°æ®åº“æœªå°±ç»ªï¼Œè¯·å…ˆä¸Šä¼ Excelæ–‡ä»¶",timestamp:new Date().toISOString(),toolCalls:[],sources:[]});return}a(""),i(!0),u(null);try{const h=l.filter(R=>R.role==="user"||R.role==="assistant").map(R=>({role:R.role,content:R.content}));h.push({role:"user",content:f}),b({role:"user",content:f,timestamp:new Date().toISOString(),toolCalls:[],sources:[]});const x=await F("/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:"rag-excel",messages:h,temperature:.7,stream:!0})});if(!x.ok)throw new Error(`HTTP ${x.status}: ${x.statusText}`);const re=x.body.getReader(),D=new TextDecoder;let C="",O="",T=[],k=[],ae=!1;for(E("ğŸ¤– æ­£åœ¨æ€è€ƒ...",[],[],!0);;){const{done:R,value:De}=await re.read();if(R)break;C+=D.decode(De,{stream:!0});const fe=C.split(`
`);C=fe.pop();for(const oe of fe)if(oe.trim()!==""&&oe.startsWith("data: ")){const ne=oe.slice(6);if(ne.trim()==="[DONE]"){setTimeout(()=>{q()},500);break}try{const A=JSON.parse(ne);if(A.choices&&A.choices[0]){const me=A.choices[0],K=me.delta||{};if(K.tool_calls){for(const N of K.tool_calls)if(N.function&&N.function.name){const z=T.findIndex(ke=>ke.id===N.id);z>=0?T[z]=N:T.push(N)}if(T.length>0&&!ae){const N=T.map(z=>z.function.name).join(", ");E(`ğŸ”§ ä½¿ç”¨å·¥å…·: ${N}`,T,k,!0)}}if(K.content&&(ae||(O="",ae=!0),O+=K.content,E(O,T,k,!0)),me.finish_reason==="stop"){k.length>0&&(O+=`

ğŸ“š **ä¿¡æ¯æ¥æº:**
`,k.forEach((N,z)=>{O+=`${z+1}. æ–‡ä»¶: ${N.file}, å·¥ä½œè¡¨: ${N.sheet}
`})),E(O,T,k,!1),setTimeout(()=>{q()},500);break}}}catch(A){console.warn("è§£æSSEæ•°æ®å¤±è´¥:",A,ne)}}}}catch(h){console.error("å‘é€æ¶ˆæ¯å¤±è´¥:",h),b({role:"system",content:`âŒ å‘é€å¤±è´¥: ${h.message}`,timestamp:new Date().toISOString(),toolCalls:[],sources:[]}),u(null)}finally{i(!1)}}},p=()=>{o([{id:"welcome",role:"assistant",content:"å¯¹è¯å·²æ¸…ç©ºï¼Œå¯ä»¥å¼€å§‹æ–°çš„æé—®ã€‚",timestamp:new Date().toISOString(),toolCalls:[],sources:[]}]),u(null)},P=f=>{f.key==="Enter"&&!f.shiftKey&&(f.preventDefault(),c())},M=()=>t?n?null:e.jsx(xe,{message:"å‘é‡æ•°æ®åº“æœªå°±ç»ª",description:"è¯·å…ˆä¸Šä¼ Excelæ–‡ä»¶åˆ°å·¦ä¾§æ–‡ä»¶ç®¡ç†å™¨",type:"warning",icon:e.jsx(V,{}),showIcon:!0,className:"system-alert"}):e.jsx(xe,{message:"ç³»ç»Ÿç¦»çº¿",description:"æ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡ï¼Œè¯·æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€",type:"error",icon:e.jsx(V,{}),showIcon:!0,className:"system-alert"});return e.jsxs("div",{className:"chat-panel",children:[M(),e.jsxs("div",{className:"messages-container",children:[l.length===0?e.jsx(_e,{image:e.jsx(H,{style:{fontSize:64,color:"#d9d9d9"}}),description:"æš‚æ— å¯¹è¯æ¶ˆæ¯"}):e.jsx(_t,{messages:l,streamingMessage:d}),e.jsx("div",{ref:_})]}),e.jsx("div",{className:"input-container",children:e.jsxs("div",{className:"input-wrapper",children:[e.jsx(Pt,{ref:j,value:r,onChange:f=>a(f.target.value),onKeyPress:P,placeholder:t?n?"è¾“å…¥æ‚¨çš„é—®é¢˜... (Shift+Enteræ¢è¡Œï¼ŒEnterå‘é€)":"è¯·å…ˆä¸Šä¼ Excelæ–‡ä»¶...":"ç³»ç»Ÿç¦»çº¿ï¼Œæ— æ³•å‘é€æ¶ˆæ¯...",disabled:!t||!n||s,autoSize:{minRows:1,maxRows:4},className:"message-input"}),e.jsxs($,{className:"input-actions",children:[e.jsx(L,{title:"æ¸…ç©ºå¯¹è¯",children:e.jsx(U,{icon:e.jsx(qe,{}),onClick:p,disabled:s||l.length<=1,type:"text"})}),e.jsx(U,{type:"primary",icon:s?e.jsx(ce,{size:"small"}):e.jsx(Ke,{}),onClick:c,disabled:!r.trim()||!t||!n||s,loading:s,children:"å‘é€"})]})]})})]})}const{Dragger:Tt}=Ge,{Text:G}=J;function It({onFileChange:t,fileCount:n}){const[l,o]=m.useState([]),[r,a]=m.useState(!1),[s,i]=m.useState(!1),[d,u]=m.useState(0),_=m.useRef(null),j=async()=>{a(!0);try{const c=await F("/v1/files/list");if(c.ok){const p=await c.json();o(p.files||[])}else S.error("è·å–æ–‡ä»¶åˆ—è¡¨å¤±è´¥")}catch(c){console.error("åŠ è½½æ–‡ä»¶åˆ—è¡¨å¤±è´¥:",c),S.error("ç½‘ç»œé”™è¯¯ï¼Œæ— æ³•è·å–æ–‡ä»¶åˆ—è¡¨")}finally{a(!1)}};m.useEffect(()=>{j()},[n]);const y=c=>{if(c===0)return"0 Bytes";const p=1024,P=["Bytes","KB","MB","GB"],M=Math.floor(Math.log(c)/Math.log(p));return parseFloat((c/Math.pow(p,M)).toFixed(2))+" "+P[M]},w=c=>new Date(c).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),b=async c=>{if(!(c.type==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"||c.type==="application/vnd.ms-excel"||c.name.endsWith(".xlsx")||c.name.endsWith(".xls")))return S.error("åªæ”¯æŒExcelæ–‡ä»¶æ ¼å¼ (.xlsx, .xls)"),!1;const P=10*1024*1024;if(c.size>P)return S.error("æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡10MB"),!1;i(!0),u(0);const M=new FormData;M.append("file",c);try{const f=setInterval(()=>{u(x=>x>=90?(clearInterval(f),x):x+Math.random()*20)},200),h=await F("/v1/files/upload",{method:"POST",body:M});if(clearInterval(f),u(100),h.ok){const x=await h.json();S.success(x.message||"æ–‡ä»¶ä¸Šä¼ æˆåŠŸ"),setTimeout(()=>{j(),t==null||t()},1e3)}else{const x=await h.json();S.error(x.detail||"ä¸Šä¼ å¤±è´¥")}}catch(f){console.error("ä¸Šä¼ æ–‡ä»¶å¤±è´¥:",f),S.error("ç½‘ç»œé”™è¯¯ï¼Œä¸Šä¼ å¤±è´¥")}finally{i(!1),u(0)}return!1},E=async c=>{try{const p=await F(`/v1/files/${encodeURIComponent(c)}`,{method:"DELETE"});if(p.ok){const P=await p.json();S.success(P.message||"æ–‡ä»¶åˆ é™¤æˆåŠŸ"),j(),t==null||t()}else{const P=await p.json();S.error(P.detail||"åˆ é™¤å¤±è´¥")}}catch(p){console.error("åˆ é™¤æ–‡ä»¶å¤±è´¥:",p),S.error("ç½‘ç»œé”™è¯¯ï¼Œåˆ é™¤å¤±è´¥")}},q={name:"file",multiple:!0,accept:".xlsx,.xls",beforeUpload:b,showUploadList:!1,disabled:s};return e.jsxs("div",{className:"file-manager",children:[e.jsxs("div",{className:"upload-section",children:[e.jsxs(Tt,{...q,className:"upload-dragger",children:[e.jsx("p",{className:"ant-upload-drag-icon",children:s?e.jsx(ce,{size:"large"}):e.jsx(He,{})}),e.jsx("p",{className:"ant-upload-text",children:s?"æ­£åœ¨ä¸Šä¼ ...":"ç‚¹å‡»æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤åŒºåŸŸä¸Šä¼ "}),e.jsx("p",{className:"ant-upload-hint",children:"æ”¯æŒ .xlsx å’Œ .xls æ ¼å¼ï¼Œå•ä¸ªæ–‡ä»¶ä¸è¶…è¿‡10MB"})]}),s&&e.jsx("div",{className:"upload-progress",children:e.jsx(Ve,{percent:Math.round(d),size:"small",status:"active"})})]}),e.jsxs("div",{className:"files-section",children:[e.jsxs("div",{className:"files-header",children:[e.jsxs($,{children:[e.jsx(G,{strong:!0,children:"çŸ¥è¯†åº“æ–‡ä»¶"}),e.jsxs(v,{color:"blue",children:[l.length," ä¸ªæ–‡ä»¶"]})]}),e.jsx(U,{icon:e.jsx(Je,{}),size:"small",onClick:j,loading:r,type:"text"})]}),e.jsx("div",{className:"files-list",children:r?e.jsx("div",{className:"loading-container",children:e.jsx(ce,{tip:"åŠ è½½ä¸­..."})}):l.length===0?e.jsx(_e,{image:e.jsx(he,{style:{fontSize:48,color:"#d9d9d9"}}),description:"æš‚æ— Excelæ–‡ä»¶",imageStyle:{height:60},children:e.jsx(U,{type:"primary",icon:e.jsx(We,{}),onClick:()=>{var c;return(c=_.current)==null?void 0:c.click()},children:"ä¸Šä¼ æ–‡ä»¶"})}):e.jsx(le,{dataSource:l,renderItem:c=>e.jsx(le.Item,{className:"file-item",actions:[e.jsx(Qe,{title:"ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ–‡ä»¶å—ï¼Ÿ",description:"åˆ é™¤åå°†ä»çŸ¥è¯†åº“ä¸­ç§»é™¤ï¼Œæ— æ³•æ¢å¤",onConfirm:()=>E(c.filename),okText:"ç¡®å®š",cancelText:"å–æ¶ˆ",children:e.jsx(U,{icon:e.jsx(Xe,{}),size:"small",type:"text",danger:!0})},"delete")],children:e.jsx(le.Item.Meta,{avatar:e.jsx(he,{className:"file-icon"}),title:e.jsx(G,{className:"file-name",title:c.filename,children:c.filename}),description:e.jsxs($,{direction:"vertical",size:2,children:[e.jsx(G,{type:"secondary",className:"file-size",children:y(c.size)}),e.jsx(G,{type:"secondary",className:"file-date",children:w(c.modified_time)})]})})})})})]}),e.jsx("input",{ref:_,type:"file",accept:".xlsx,.xls",multiple:!0,style:{display:"none"},onChange:c=>{Array.from(c.target.files).forEach(b),c.target.value=""}})]})}const{Text:Ft}=J;function Mt({status:t}){const{online:n,vectorStoreReady:l,fileCount:o,lastUpdate:r}=t,a=d=>{if(!d)return"æœªçŸ¥";const u=new Date(d),j=new Date-u,y=Math.floor(j/(1e3*60)),w=Math.floor(y/60),b=Math.floor(w/24);return y<1?"åˆšåˆš":y<60?`${y}åˆ†é’Ÿå‰`:w<24?`${w}å°æ—¶å‰`:b<7?`${b}å¤©å‰`:u.toLocaleDateString("zh-CN")},s=()=>n?l?e.jsx(v,{icon:e.jsx(Ze,{}),color:"success",className:"status-tag",children:"æ­£å¸¸"}):e.jsx(v,{icon:e.jsx(V,{}),color:"warning",className:"status-tag",children:"æœªå°±ç»ª"}):e.jsx(v,{icon:e.jsx(ge,{}),color:"error",className:"status-tag",children:"ç¦»çº¿"}),i=()=>n?l?e.jsx(v,{icon:e.jsx(et,{}),color:"success",size:"small",children:"å°±ç»ª"}):e.jsx(v,{icon:e.jsx(V,{}),color:"warning",size:"small",children:"æœªå°±ç»ª"}):e.jsx(v,{icon:e.jsx(ge,{}),color:"default",size:"small",children:"ç¦»çº¿"});return e.jsx("div",{className:"system-status",children:e.jsxs($,{size:"middle",className:"status-items",children:[e.jsx(L,{title:e.jsxs("div",{children:[e.jsxs("div",{children:["ç³»ç»ŸçŠ¶æ€: ",n?"åœ¨çº¿":"ç¦»çº¿"]}),e.jsxs("div",{children:["å‘é‡åº“: ",l?"å°±ç»ª":"æœªå°±ç»ª"]}),r&&e.jsxs("div",{children:["æœ€åæ›´æ–°: ",a(r)]})]}),placement:"bottomRight",children:e.jsx("div",{className:"status-item",children:s()})}),e.jsx(L,{title:`å‘é‡æ•°æ®åº“${l?"å·²å°±ç»ªï¼Œå¯ä»¥è¿›è¡Œé—®ç­”":"æœªå°±ç»ªï¼Œè¯·å…ˆä¸Šä¼ Excelæ–‡ä»¶"}`,placement:"bottom",children:e.jsx("div",{className:"status-item",children:i()})}),e.jsx(L,{title:`çŸ¥è¯†åº“ä¸­å…±æœ‰ ${o} ä¸ªExcelæ–‡ä»¶`,placement:"bottom",children:e.jsx("div",{className:"status-item",children:e.jsxs(v,{icon:e.jsx(ue,{}),color:"blue",size:"small",children:[o," æ–‡ä»¶"]})})}),r&&e.jsx(L,{title:`å‘é‡åº“æœ€åæ›´æ–°æ—¶é—´: ${new Date(r).toLocaleString("zh-CN")}`,placement:"bottomLeft",children:e.jsx("div",{className:"status-item",children:e.jsx(v,{icon:e.jsx($e,{}),color:"default",size:"small",children:a(r)})})})]})})}const{Header:Rt,Content:Et,Footer:Ot}=we,{Title:zt,Text:ie}=J;function Dt(){const[t,n]=m.useState({online:!1,vectorStoreReady:!1,fileCount:0,lastUpdate:null}),[l,o]=m.useState(0),r=()=>{o(a=>a+1)};return m.useEffect(()=>{const a=async()=>{try{const i=await F("/health");if(i.ok){const d=await i.json();n({online:!0,vectorStoreReady:d.vector_store_ready,fileCount:d.knowledge_base_files,lastUpdate:d.last_update})}else n(d=>({...d,online:!1}))}catch(i){console.error("ç³»ç»ŸçŠ¶æ€æ£€æŸ¥å¤±è´¥:",i),n(d=>({...d,online:!1}))}};a();const s=setInterval(a,3e4);return()=>clearInterval(s)},[l]),e.jsxs(we,{className:"app-layout",children:[e.jsx(Rt,{className:"app-header",children:e.jsxs("div",{className:"header-content",children:[e.jsxs($,{align:"center",size:"large",children:[e.jsxs("div",{className:"logo",children:[e.jsx(H,{className:"logo-icon"}),e.jsx(zt,{level:3,className:"logo-text",children:"RAG Excel API"})]}),e.jsx(je,{type:"vertical",className:"header-divider"}),e.jsx(ie,{className:"subtitle",children:"æ™ºèƒ½Excelé—®ç­”ç³»ç»Ÿ"})]}),e.jsxs($,{align:"center",children:[e.jsx(Mt,{status:t}),e.jsxs("a",{href:"http://localhost:8000/docs",target:"_blank",rel:"noopener noreferrer",className:"header-link",children:[e.jsx(tt,{})," APIæ–‡æ¡£"]})]})]})}),e.jsx(Et,{className:"app-content",children:e.jsx("div",{className:"content-container",children:e.jsxs(st,{gutter:[24,24],className:"main-row",children:[e.jsx(ye,{xs:24,lg:8,xl:6,children:e.jsx(ve,{title:e.jsxs($,{children:[e.jsx(ue,{}),"æ–‡ä»¶ç®¡ç†"]}),className:"file-manager-card",bodyStyle:{padding:"16px"},children:e.jsx(It,{onFileChange:r,fileCount:t.fileCount})})}),e.jsx(ye,{xs:24,lg:16,xl:18,children:e.jsx(ve,{title:e.jsxs($,{children:[e.jsx(H,{}),"æ™ºèƒ½é—®ç­”"]}),className:"chat-panel-card",bodyStyle:{padding:0},children:e.jsx(Ct,{systemOnline:t.online,vectorStoreReady:t.vectorStoreReady})})})]})})}),e.jsx(Ot,{className:"app-footer",children:e.jsx("div",{className:"footer-content",children:e.jsxs($,{split:e.jsx(je,{type:"vertical"}),children:[e.jsx(ie,{type:"secondary",children:"Â© 2024 RAG Excel API - åŸºäºæ£€ç´¢å¢å¼ºç”Ÿæˆçš„æ™ºèƒ½é—®ç­”ç³»ç»Ÿ"}),e.jsxs("a",{href:"https://github.com",target:"_blank",rel:"noopener noreferrer",className:"footer-link",children:[e.jsx(rt,{})," GitHub"]}),e.jsx(ie,{type:"secondary",children:"Powered by FastAPI + React + Ollama"})]})})})]})}de.createRoot(document.getElementById("root")).render(e.jsx(Fe.StrictMode,{children:e.jsx(at,{locale:$t,theme:{token:{colorPrimary:"#1890ff",borderRadius:8}},children:e.jsx(Dt,{})})}));
